<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>QA Plant Visit Form</title>

<style>
  body {
    font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background:#f4f6f9;
    margin:0;
    padding:0;
  }
  .container {
    max-width: 760px;
    margin: 30px auto;
    background: #fff;
    padding: 28px;
    border-radius: 10px;
    box-shadow: 0 4px 12px rgba(0,0,0,0.07);
  }
  h1 { margin-top:0; }
  .hidden { display:none; }
  .btn {
    background:#1a3b5d;
    color:#fff;
    padding:10px 18px;
    border:none;
    border-radius:6px;
    cursor:pointer;
    font-size:15px;
  }
  .btn:disabled { opacity:0.5; cursor:not-allowed; }
  .nav-btn {
    margin-top:16px;
    background:#888;
  }
  #submit-spinner {
    margin-left:8px;
    display:none;
  }
  #submit-status {
    margin-top:14px;
    font-size:14px;
  }
</style>

<!-- CONFIG: YOUR GOOGLE SCRIPT URL -->
<script>
  const GOOGLE_SCRIPT_URL =
    "https://script.google.com/macros/s/AKfycbxjh6BDjyjGqmk5ryfIfoWI2HXKOoaRJnKrXuF87gJM-65BN9nzkHrb9qluhCxfZmxcMg/exec";
</script>

</head>
<body>

<div class="container">

  <h1>QA Plant Visit Form</h1>

  <!-- Multi-page wrapper -->
  <form id="qa-visit-form">

    <!-- PAGE 1 -->
    <div id="page1">

      <label>Plant Name</label><br>
      <input type="text" name="Plant" required style="width:100%; padding:8px; margin-bottom:16px;"><br>

      <label>Inspector</label><br>
      <input type="text" name="Inspector" required style="width:100%; padding:8px; margin-bottom:16px;"><br>

      <label>Date of Visit</label><br>
      <input type="date" name="Visit Date" required style="padding:8px; margin-bottom:16px;"><br>

      <button type="button" id="nextBtn" class="btn nav-btn">Next Page →</button>
    </div>


    <!-- PAGE 2 -->
    <div id="page2" class="hidden">

      <label>Overall Findings</label><br>
      <textarea name="Overall Findings" rows="4" style="width:100%;padding:8px;margin-bottom:16px;"></textarea><br>

      <label>Corrective Actions Needed</label><br>
      <textarea name="Corrective Actions" rows="4" style="width:100%;padding:8px;margin-bottom:16px;"></textarea><br>

      <button type="button" id="backBtn" class="btn nav-btn">← Back</button>
      <button type="submit" class="btn" style="float:right;">Submit Report</button>
      <span id="submit-spinner">⏳</span>

      <div style="clear:both;"></div>
    </div>

  </form>

  <div id="submit-status"></div>
</div>


<!-- SUBMIT + PAGE NAV LOGIC -->
<script>
document.addEventListener("DOMContentLoaded", () => {

  // Page switching
  const page1 = document.getElementById("page1");
  const page2 = document.getElementById("page2");
  document.getElementById("nextBtn").onclick = () => {
    page1.classList.add("hidden");
    page2.classList.remove("hidden");
  };
  document.getElementById("backBtn").onclick = () => {
    page2.classList.add("hidden");
    page1.classList.remove("hidden");
  };

  const form = document.getElementById("qa-visit-form");
  const statusEl = document.getElementById("submit-status");
  const spinnerEl = document.getElementById("submit-spinner");

  form.addEventListener("submit", async (e) => {
    e.preventDefault();

    // UI lock
    const submitBtn = form.querySelector('button[type="submit"]');
    submitBtn.disabled = true;
    spinnerEl.style.display = "inline-block";
    statusEl.textContent = "Submitting QA Plant Visit report…";
    statusEl.style.color = "#444";

    try {
      // Collect form contents
      const fd = new FormData(form);
      const payload = {};
      for (const [key, value] of fd.entries()) {
        payload[key] = value;
      }

      // Send to Apps Script
      const res = await fetch(GOOGLE_SCRIPT_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      });

      let data = null;
      try { data = await res.json(); } catch(_) {}

      if (!res.ok || !data || data.status !== "success") {
        statusEl.style.color = "#b00020";
        statusEl.textContent = "Error submitting report. Please try again.";
        return;
      }

      // SUCCESS
      statusEl.style.color = "#0a7c2f";
      statusEl.textContent = "Report submitted successfully! Email + PDF sent.";
      form.reset();

      // Optional: send them back to Page 1
      page2.classList.add("hidden");
      page1.classList.remove("hidden");

    } catch (err) {
      console.error(err);
      statusEl.style.color = "#b00020";
      statusEl.textContent = "Network error. Check connection or deployment.";
    } finally {
      spinnerEl.style.display = "none";
      submitBtn.disabled = false;
    }
  });
});
</script>

</body>
</html>
